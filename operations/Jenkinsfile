#!/usr/bin/env groovy

pipeline {
    agent any
    stages {
        stage('Configure Directories') {
            steps {
                sh """pwd
                rm -rf drupal.zip
                ls -lart
                zip -r drupal.zip . -x '*.git*' -q
                """
            }
        }
        stage('Copy to remote server') {
            steps {
                sh """pwd
                scp -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i /var/lib/jenkins/.ssh/common-key-mumbai.pem drupal.zip ubuntu@13.234.148.202:/tmp
                echo A | unzip /tmp/drupal.zip -d /drupal/_data/
                """
            }
        }
    }
}
